<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="我是谁？我在做什么？我为什么要这么做？我想做什么？我要怎么做？">
<meta property="og:type" content="website">
<meta property="og:title" content="Sparky">
<meta property="og:url" content="http://yoursite.com/page/7/index.html">
<meta property="og:site_name" content="Sparky">
<meta property="og:description" content="我是谁？我在做什么？我为什么要这么做？我想做什么？我要怎么做？">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Sparky">
<meta name="twitter:description" content="我是谁？我在做什么？我为什么要这么做？我想做什么？我要怎么做？">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"right","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/7/"/>





  <title>Sparky</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?23f2f984b557cd9c31da9a75b4da08e4";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Sparky</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/06/Espresso自动化测试框架学习/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sparky">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/logo_s.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sparky">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/06/Espresso自动化测试框架学习/" itemprop="url">未命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-06T20:09:10+08:00">
                2019-05-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Espresso-UI自动化测试框架"><a href="#Espresso-UI自动化测试框架" class="headerlink" title="Espresso UI自动化测试框架"></a>Espresso UI自动化测试框架</h2><h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>Espresso是谷歌大力推荐的一套测试框架，从Android studio2.2版本开始，google就开始支持在as上espresso自动生成单元测试代码。</p>
<p>Espresso测试运行速度很快，它允许你在应用程序处于静止时操作和断言等。</p>
<p>Espresso面向那些认为自动化测试是开发声明周期的一部分的开发人员，并且虽然它可以被用作黑盒测试，但是熟悉代码库的人可以解锁Espresso的全部功能。</p>
<h4 id="简单实例"><a href="#简单实例" class="headerlink" title="简单实例"></a>简单实例</h4><p>Espresso非常简单医用，并且可定制，能清楚的表明期望，交互和断言。</p>
<pre><code>@Test
public void test(){
    onView(withId(R.id.test)).perform(click()).check(matches(withText(&quot;clicked&quot;)));
}
</code></pre><p>每次调用onView()时，Espresso都会等待执行相应的操作和断言，知道满足一下条件为止。</p>
<ul>
<li>The message queue is empty.</li>
<li>There are no instances of AsyncTask currently executing a task.</li>
<li>All developer-defined idling resources are idle.</li>
</ul>
<h4 id="依赖的类库"><a href="#依赖的类库" class="headerlink" title="依赖的类库"></a>依赖的类库</h4><ul>
<li>espresso-core 包含基础的视图匹配器，操作和断言库</li>
<li>espresso-web 包含webview的测试库</li>
<li>espresso-idling-resource 包含和后台作业的同步的机制</li>
<li>espresso-contrib 包括DatePicker, RecyclerView and Drawer actions, accessibility checks, and CountingIdlingResource这些的扩展库</li>
<li>espresso-intent 包括与意图有关的测试库</li>
<li>espresso-remote Espresso多处理功能的位置</li>
</ul>
<h4 id="设置和使用"><a href="#设置和使用" class="headerlink" title="设置和使用"></a>设置和使用</h4><h5 id="1-设置测试环境"><a href="#1-设置测试环境" class="headerlink" title="1. 设置测试环境"></a>1. 设置测试环境</h5><p>为了避免测试过程出现问题，最好关闭开发者选项中的下边三个设置。</p>
<ul>
<li>Window animation scale</li>
<li>Transition animation scale</li>
<li>Animator duration scale</li>
</ul>
<h5 id="2-配置gradle"><a href="#2-配置gradle" class="headerlink" title="2. 配置gradle"></a>2. 配置gradle</h5><pre><code>dependencies{
androidTestImplementation &apos;com.android.support.test.espresso:espresso-core:3.0.2&apos;
androidTestImplementation &apos;com.android.support.test:runner:1.0.2&apos;
androidTestImplementation &apos;com.android.support.test:rules:1.0.2&apos;
}
...
android{
    defaultConfig{
        testInstrumentationRunner &quot;android.support.test.runner.AndroidJUnitRunner&quot;
    }
}
</code></pre><blockquote>
<p>注意： Android Studio现在新建项目一般都会依赖部分Espresso的库，但是有的仍需要引入部分库，比如我的Android studio 3.0.1需要引入’com.android.support.test:rules:1.0.2’库</p>
</blockquote>
<h5 id="3-编写测试代码"><a href="#3-编写测试代码" class="headerlink" title="3. 编写测试代码"></a>3. 编写测试代码</h5><pre><code>@LarggeTest
@RunWith(AndroidJUnit4.class)
public class MainActivityTest{
    @Rule
    public ActivityTestRule mActivityRule = new ActivityTestRule(MainActivity.class);

    @Test
    public void runTest(){
        onView(withId(R.id.test)).perform(click()).check(matches(withText(&quot;2&quot;)));
    }
}
</code></pre><blockquote>
<p>注意： ActivityTestRule需要导入上一步的一个rules库。<br>如果onView等方法没有代码提示，可以手动先导入相关类库。</p>
</blockquote>
<h5 id="4-运行测试用例"><a href="#4-运行测试用例" class="headerlink" title="4. 运行测试用例"></a>4. 运行测试用例</h5><p>可以使用as的运行功能也可以使用命令行方式</p>
<h6 id="在Android-Studio中："><a href="#在Android-Studio中：" class="headerlink" title="在Android Studio中："></a>在Android Studio中：</h6><ol>
<li>打开Run -&gt; Edit Configurations</li>
<li>添加一个新的测试配置</li>
<li>选择module</li>
<li>添加一个指定的runner：android.support.test.runner.AndroidJUnitRunner</li>
<li>运行新配置</li>
</ol>
<h6 id="在命令行中"><a href="#在命令行中" class="headerlink" title="在命令行中"></a>在命令行中</h6><p>执行以下代码：</p>
<pre><code>./gradlew connectedAndroidTest
</code></pre><h4 id="Espresso-API"><a href="#Espresso-API" class="headerlink" title="Espresso API"></a>Espresso API</h4><p>Espresso API鼓励开发者根据用户与应用程序交互时可能执行的操作进行思考-定位UI元素并与之进行交互，同时框架阻止直接访问应用程序的活动和视图。</p>
<p>API中主要包括以下的包：</p>
<ul>
<li>Espresso 与视图交互的入口(onView(),onData()),同时公开不一定与视图绑定的api，例如pressBack()</li>
<li>ViewMatchers 一组实现了Matcher&lt; ? super View&gt;接口的对象，你可以将这个作为筛选条件在onView中定位视图</li>
<li>ViewAction 一组可以被传递给ViewInteraction.perform()的ViewAction对象，比如click()</li>
<li>ViewAssertions 一组可以被传递给ViewInteraction.check()方法的ViewAssertion对象，大多数情况下，你需要使用这个匹配断言，当一个viewmatcher去断言一个view的状态的时候。</li>
</ul>
<p>实例：</p>
<pre><code>onView(withId(R.id.test)) // withId() is a ViewMatcher
    .perform(click()) // click() is a ViewAction
    .check(matches(isDisplayed())); // matches(isDisplayed()) // is a ViewAssertion, isDisplayed() is a ViewMatcher
</code></pre><h6 id="定位视图"><a href="#定位视图" class="headerlink" title="定位视图"></a>定位视图</h6><p>通常期望的视图具有唯一性，但是有的情况下，通过ViewMater匹配的视图不唯一，此时就会报出异常：</p>
<pre><code>android.support.test.espresso.AmbiguousViewMatcherException
此匹配器匹配层次结构中的多个视图:( withId：&lt;123456789&gt;）
</code></pre><p>所以Espresso提供了组合匹配器来缩小搜索范围：</p>
<pre><code>onView(allOf(withId(R.id.my_view), withText(&quot;Hello!&quot;)))
</code></pre><p>也可以使用反转匹配器</p>
<pre><code>onView(allOf(withId(R.id.test), not(withText(&quot;Hello&quot;))));
</code></pre><blockquote>
<p>注意：</p>
<ol>
<li>在行为良好的应用程序中，可交互视图都有描述性文本和内容描述文本。如果您无法使用withText()或 缩小搜索范围withContentDescription()，请考虑将其视为可访问性错误 </li>
<li>通常，一个视图都有唯一的标示。当一个视图有唯一的标示时，就不需要再去指定其他的匹配器去匹配。</li>
<li>如果一个目标view是adapterview，例如listview，gridview或者spinner，请使用onData()去获取数据</li>
</ol>
</blockquote>
<p>请参阅<a href="https://developer.android.google.cn/reference/android/support/test/espresso/matcher/ViewMatchers.html" target="_blank" rel="noopener">ViewMatchers</a> Espresso提供的视图匹配器。</p>
<h6 id="操作视图"><a href="#操作视图" class="headerlink" title="操作视图"></a>操作视图</h6><p>当找到目标视图之后，可以使用perform方法对其进行操作.<br>例如要单击视图：</p>
<pre><code>onView(...).perform(click());
</code></pre><p>执行多个操作：</p>
<pre><code>onView(...).perform(typeText(&quot;hello&quot;), click());
</code></pre><p>如果目标视图位于scrollview内部，需要考虑显示视图之前的操作，比如scrollTo().</p>
<pre><code>onView(...).perform(scrollTo(), click());
</code></pre><p>请参阅<a href="https://developer.android.google.cn/reference/android/support/test/espresso/action/ViewActions.html" target="_blank" rel="noopener">ViewActions</a>查看详细API操作。</p>
<h6 id="断言检查"><a href="#断言检查" class="headerlink" title="断言检查"></a>断言检查</h6><p>可以使用check()将断言应用与当前视图。最常见的断言是matches()断言。</p>
<p>下边的示例中，SimpleActivity包含a Button和a TextView。单击按钮时，内容TextView将更改为”Hello Espresso!”。</p>
<pre><code>// 匹配视图button及操作视图
onView(withId(R.id.button_simple)).perform(click());

// 验证文本
onView(withId(R.id.text_simple)).check(matches(withText(&quot;Hello Espresso!&quot;)));
</code></pre><h6 id="检查AdapterView中的数据加载"><a href="#检查AdapterView中的数据加载" class="headerlink" title="检查AdapterView中的数据加载"></a>检查AdapterView中的数据加载</h6><p>AdapterView比较特殊，它只能显示当前数据的一个子集的view，所以onView()不会匹配到那些没有显示的view。</p>
<p>Espresso单独提供了onData()入口来处理这个问题，该入口能够首先加载所有的item。</p>
<p>下边是一个使用 onData()的例子。</p>
<pre><code>// open the item selection
onView(withId(R.id.spinner_simpke)).perform(click());
// select an item
onData(allOf(instanceOf(String.class)), is(&quot;Americano&quot;)).perform(click());
// verify text correct
onView(withId(R.id.spiinertext_simple)).check(matches(withText(containsString(&quot;Americano&quot;))))
</code></pre><h4 id="Espresso-recipes"><a href="#Espresso-recipes" class="headerlink" title="Espresso recipes"></a>Espresso recipes</h4><p>本篇主要介绍Espresso的进阶用法。</p>
<h5 id="匹配另一个视图旁边的视图"><a href="#匹配另一个视图旁边的视图" class="headerlink" title="匹配另一个视图旁边的视图"></a>匹配另一个视图旁边的视图</h5><p><img src="https://developer.android.google.cn/images/training/testing/repeated-view.png" alt="匹配另一个视图旁边的视图"><br>如上图所示，如果我们要去匹配7旁边的item视图时，因为7是非唯一视图，item是唯一视图，我们可以使用组合匹配器，先去匹配非唯一视图，然后使用hasSibling(0匹配器缩小选择范围。</p>
<pre><code>onView(allOf(withText(7), hasSibling(withText(&quot;item: 0&quot;)))).perform(click());
</code></pre><h5 id="匹配Actionbar里边的视图"><a href="#匹配Actionbar里边的视图" class="headerlink" title="匹配Actionbar里边的视图"></a>匹配Actionbar里边的视图</h5><p>主要是指 ActionBar的控件和Option Item<br>如果是在actionbar中可见的的视图，是比较简单的。</p>
<pre><code>onView(withId(R.id.xxx)).perform(click());
</code></pre><p>对于option item来说，有的是通过右上角的menu button调出的，有的是通过虚拟菜单键调出的。幸运的是，Espresso为我们处理了额这个问题。</p>
<p>对于正常的操作栏：</p>
<pre><code>openActionBarOverflowOrOptionsMenu(getInstrumentation().getTargetContext());
onView(withText(&quot;World&quot;)).perform(click());
</code></pre><p>对于上下文相关的操作栏</p>
<pre><code>openContexturlActionModeOverflowMenu();
onView(withText(&quot;Hello&quot;)).perform(click());
</code></pre><h5 id="断言view是否显示"><a href="#断言view是否显示" class="headerlink" title="断言view是否显示"></a>断言view是否显示</h5><pre><code>onView(withId(R.id.test)).check(matches(not(isDisplayed())));
</code></pre><h5 id="断言view是否存在"><a href="#断言view是否存在" class="headerlink" title="断言view是否存在"></a>断言view是否存在</h5><pre><code>onView(withId(R.id.test)).check(doesNotExist());
</code></pre><h5 id="断言数据项不在适配器中"><a href="#断言数据项不在适配器中" class="headerlink" title="断言数据项不在适配器中"></a>断言数据项不在适配器中</h5><p>断言数据想不在适配器中需要我们拿到adapter item，并与数据做匹配。这需要我们自己定义方法去匹配。</p>
<pre><code>private static Matcher&lt;View&gt; withAdapterData(Matcher&lt;Object&gt; dataMatcher) {
    @Override
    public void describeTo(Description description){
        description.appendText(&quot;with class name: &quot;);
        dataMatcher.describeTo(description);
    }

    @Override
    public boolean matchesSafely(View view) {
        if (!(view instanceof AdapterView)) {
            return false;
        }

        Adapter adapter = view.getAdapter();
        for (int i = 0; i &lt; adapter.getCount(); i++) {
        if (dataMatch.matches(adapter.getItem(i))){
            return true;
        }
        }

        return false;
    }
}

onView(withId(R.id.list)).check(matches(withAdapterData(withItemContent(&quot;item 1&quot;))));
</code></pre><blockquote>
<p>注意： 部分代码详见<a href="https://android.googlesource.com/platform/frameworks/testing/+/android-support-test/espresso/sample/src/androidTest/java/android/support/test/testapp/AdapterViewTest.java" target="_blank" rel="noopener">AdapterViewTest.java</a></p>
</blockquote>
<h5 id="自定义故障处理程序"><a href="#自定义故障处理程序" class="headerlink" title="自定义故障处理程序"></a>自定义故障处理程序</h5><p>espresso允许开发者自定义FailureHandler用于错误处理，常见的做法有收集错误信息，截图或者传递额外的调试信息。</p>
<pre><code>private static class CustomFailureHandler implements FailureHandler {
    private final FailureHandler delegate;
    public CustomFailureHandler(Context targetContext) {
        delegate = new DefaultFailureHandler(targetContext);
    }

    @Override
    public void handle(Throwable error, Matcher&lt;View&gt; viewMatcher){
        try {
            delegate.handle(error, viewMatcher);
        } catch (NoMatchingViewException e) {
            throw new MySpecialException(e);
        }
    }
}
</code></pre><p>需要自己定义Exception，并且在test中setFailureHandler();一般在setUp()中定义。</p>
<h5 id="定位非默认窗口"><a href="#定位非默认窗口" class="headerlink" title="定位非默认窗口"></a>定位非默认窗口</h5><pre><code>onView(withText(&quot;south china sea&quot;))
    .inRoot(withDecorView(not(is(getActivity().getWindow().getDecorView()))))
    .perform(click());
</code></pre><h5 id="在列表视图中匹配页眉和页脚"><a href="#在列表视图中匹配页眉和页脚" class="headerlink" title="在列表视图中匹配页眉和页脚"></a>在列表视图中匹配页眉和页脚</h5><p>想要匹配页眉和页脚，必须在listview.addFooter()或者listview.addHeader()中传递第二个参数。这个参数起到关联作用。例如：</p>
<pre><code>public static final String FOOTER = &quot;FOOTER&quot;;
...
View footerView = layoutInflater.inflate(R.layout.list_item, listView, false);
((TextView) footerView.findViewById(R.id.item_content)).setText(&quot;count:&quot;);
((TextView) footerView.findViewById(R.id.item_size)).setText(String.valueOf(data.size()));
listView.addFooterView(footerView, FOOTER, true);
</code></pre><p>测试代码：</p>
<pre><code>public static Matcher&lt;Object&gt; isFooter(){
    return allOf(is(instanceOf(String.class)), is(FOOTER));
}

public void testFooter(){
    onData(isFooter()).perform(click());
}
</code></pre><h4 id="多进程"><a href="#多进程" class="headerlink" title="多进程"></a>多进程</h4><p>espresso允许跨进程测试，但是只是在Android 8.0及以上版本。所以请注意以下两点：</p>
<ul>
<li>应用最低版本为8.0，也就是API 26。</li>
<li>只能测试应用内的进程，无法测试外部进程。</li>
</ul>
<h5 id="使用步骤"><a href="#使用步骤" class="headerlink" title="使用步骤"></a>使用步骤</h5><p>在build.gradle中引用espresso-remote库</p>
<pre><code>dependencies {
...
androidTestImplementation &apos;com.android.support.test.espresso:espresso-remote:3.0.2&apos;
}
</code></pre><p>并且需要在androidTest的Manifest文件中添加以下代码：</p>
<pre><code>&lt;instrumentation android:name=&quot;android.support.test.runner.AndroidJUnitRunner&quot;
android:targetPackage=&quot;android.support.mytestapp&quot;
android:targetProcesses=&quot;xxx&quot;/&gt;

&lt;meta-data
android:name=&quot;remoteMethod&quot;
android:value=&quot;android.support.test.espresso.remote.EspressoRemote#remoteInit&quot; /&gt;
</code></pre><h4 id="辅助功能检查"><a href="#辅助功能检查" class="headerlink" title="辅助功能检查"></a>辅助功能检查</h4><p>AccessibilityCheck允许使用现有代码来测试可访问性问题。它会在测试动作方法之前发生。</p>
<pre><code>import android.support.test.espresso.contrib.AccessibilityChecks;

@RunWith(AndroidJUnit4.class)
@LargeTest
public class AccessibilityChecksIntegrationTest {
    @BeforeClass
    public static void enableAccessibilityChecks() {
        AccessibilityChecks.enable();
    }
}
</code></pre><h4 id="list"><a href="#list" class="headerlink" title="list"></a>list</h4><p>list分为两种adapterview和recyclerview。</p>
<h5 id="与adapterview列表项的交互"><a href="#与adapterview列表项的交互" class="headerlink" title="与adapterview列表项的交互"></a>与adapterview列表项的交互</h5><p>普通写法</p>
<pre><code>onData(allOf(is(instanceOf(Map.class)), hasEntry(equalTo(&quot;STR&quot;), is(&quot;item: 50&quot;))));
</code></pre><p>注意，Espresso会根据需要自动滚动列表。</p>
<p>我们分析上边的代码，首先is(instanceOf(Map.class))会将搜索范围缩小到map集合，然后hasEntry()会去匹配集合里key为“str”和value为”item: 50”的条目。</p>
<p>因为上述代码较长，我们可以自定义matcher去match</p>
<pre><code>private static Matcher&lt;Object&gt; withItemContent(String expectedText) {
    checkNotNull(expectedText);
    return withItemContent(equalTo(expectedText));
}

private static Matcher&lt;Object&gt; withItemContent(Matcher&lt;Object&gt; itemTextMatcher) {
    return new BoundedMatcher&lt;&gt;(Map.class){
        @Override
public boolean matchesSafely(Map map) {
    return hasEntry(equalTo(&quot;STR&quot;), itemTextMatcher).matches(map);
}

@Override
public void describeTo(Description description) {
    description.appendText(&quot;with item content: &quot;);
    itemTextMatcher.describeTo(description);
}
    }
}
</code></pre><p>这样就可以简单的调用了</p>
<pre><code>onData(withItemContent(&quot;xxx&quot;)).perform(click());
</code></pre><h5 id="操作child-view"><a href="#操作child-view" class="headerlink" title="操作child view"></a>操作child view</h5><pre><code>onData(withItemContent(&quot;xxx&quot;)).onChildView(withId(R.id.tst)).perform(click());
</code></pre><h4 id="和recyclerview的条目交互"><a href="#和recyclerview的条目交互" class="headerlink" title="和recyclerview的条目交互"></a>和recyclerview的条目交互</h4><p>espresso-contrib库中包含一系列recyclerviewactions。</p>
<ul>
<li>scrollTo 滚动到匹配的view</li>
<li>scrollToHolder 滚动到匹配的viewholder</li>
<li>scrollToPosition 滚动到指定的position</li>
<li>actionOnHolderItem 在匹配到的view holder中进行操作</li>
<li>actionOnItem 在匹配到的item view上进行操作</li>
<li>actionOnItemAtPosition 在指定位置的view上进行操作</li>
</ul>
<p>实例：</p>
<pre><code>@Test
public void scrollToItemBelowFold_checkItsText() {
    // First, scroll to the position that needs to be matched and click on it.
    onView(ViewMatchers.withId(R.id.recyclerView))
            .perform(RecyclerViewActions.actionOnItemAtPosition(ITEM_BELOW_THE_FOLD,
            click()));

    // Match the text in an item below the fold and check that it&apos;s displayed.
    String itemElementText = mActivityRule.getActivity().getResources()
            .getString(R.string.item_element_text)
            + String.valueOf(ITEM_BELOW_THE_FOLD);
    onView(withText(itemElementText)).check(matches(isDisplayed()));
}
@Test
public void itemInMiddleOfList_hasSpecialText() {
    // First, scroll to the view holder using the isInTheMiddle() matcher.
    onView(ViewMatchers.withId(R.id.recyclerView))
            .perform(RecyclerViewActions.scrollToHolder(isInTheMiddle()));

    // Check that the item has the special text.
    String middleElementText =
            mActivityRule.getActivity().getResources()
            .getString(R.string.middle);
    onView(withText(middleElementText)).check(matches(isDisplayed()));
}
</code></pre><h4 id="意图"><a href="#意图" class="headerlink" title="意图"></a>意图</h4><p>Espresso-intents库是对espresso的扩展，可以对被测应用程序发出的意图进行验证和存根。</p>
<h5 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h5><ol>
<li>该功能需要 Android Support Repository</li>
<li><p>build.gradle的dependencies中添加</p>
<pre><code>androidTestImplementation &apos;com.android.support.test.espresso:espresso-intents:3.0.2&apos;
</code></pre></li>
<li><p>add intent test rule</p>
<pre><code>@Rule
public IntentsTestRule&lt;MyActivity&gt; intentsTestRule = new IntentTestRule&lt;&gt;(MyActivity.class);
</code></pre></li>
<li><p>match</p>
<p> Hamcrest的匹配的条件是使用Hamcrest Matchers定义的，Hamcrest允许使用一下两种意图匹配器：</p>
<ul>
<li>使用现有的意图匹配器</li>
<li><p>使用自己的意图匹配器</p>
<p>Espresso-intents分别提供了意图验证和存根的方法intented()和intending().</p>
<p>以下代码展示了使用启动浏览器的意图匹配的方式：</p>
<pre><code>intented(allOf(
    hasActoin(equalTo(Intent.ACTION_VIEW)),
    hasCategories(hasItem(qualTo(Intent.CATEGORY_BROWSABLE))),
    hasData(hasHost(equalTo(&quot;www.google.com&quot;))),
    hasExtras(allOf(hasEntry(equalTo(&quot;key1&quot;), equalTo(&quot;value1&quot;)),
    toPackage(&quot;com.android.browser&quot;)))));    
</code></pre></li>
</ul>
</li>
<li><p>validate intents</p>
<pre><code>intented(toPackage(&quot;com.android.phone&quot;));
</code></pre></li>
<li><p>stubbing</p>
<pre><code>1. 构建结果以在启动特定活动时返回。
2. 指示存根结果以响应意图
3. 验证是否产生了预期的目标

完整代码如下：

    // Build the result to return when the activity is launched.
    Intent resultData = new Intent();
    String phoneNumber = &quot;123-345-6789&quot;;
    resultData.putExtra(&quot;phone&quot;, phoneNumber);
    ActivityResult result =
        new ActivityResult(Activity.RESULT_OK, resultData);

    // Set up result stubbing when an intent sent to &quot;contacts&quot; is seen.
    intending(toPackage(&quot;com.android.contacts&quot;)).respondWith(result);

    // User action that results in &quot;contacts&quot; activity being launched.
    // Launching activity expects phoneNumber to be returned and displayed.
    onView(withId(R.id.pickButton)).perform(click());

    // Assert that the data we set up above is shown.
    onView(withId(R.id.phoneNumber)).check(matches(withText(phoneNumber)));
</code></pre></li>
</ol>
<h4 id="webview"><a href="#webview" class="headerlink" title="webview"></a>webview</h4><p><a href="https://developer.android.google.cn/training/testing/espresso/web" target="_blank" rel="noopener"><br>Espresso Web</a></p>
<p>应该用不到吧，跳过了</p>
<h4 id="idling-resource"><a href="#idling-resource" class="headerlink" title="idling resource"></a>idling resource</h4><p><a href="https://developer.android.google.cn/training/testing/espresso/idling-resource" target="_blank" rel="noopener">闲置资源</a></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><a href="https://android.github.io/android-test/downloads/espresso-cheat-sheet-2.1.0.pdf" target="_blank" rel="noopener">Espresso小结备忘.pdf</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/06/Effective Java 2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sparky">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/logo_s.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sparky">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/06/Effective Java 2/" itemprop="url">未命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-06T20:09:10+08:00">
                2019-05-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Effective-Java-2"><a href="#Effective-Java-2" class="headerlink" title="Effective Java 2"></a>Effective Java 2</h2><h3 id="适用于"><a href="#适用于" class="headerlink" title="适用于"></a>适用于</h3><p>本书适用于有java基础,但对于代码精益求精的java中高级程序员,通过78条程序员必备的经验法则,使我们在编程过程中更加高效和实用.</p>
<h3 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h3><ul>
<li>第二章 对象的创建和销毁</li>
<li>第三章 详细讲解一些对象的通用方法</li>
<li>第四章 类和接口的设计</li>
<li>第五章和第六章 泛型,枚举,注解实践</li>
<li>第七章 设计函数</li>
<li>第八章 通用程序设计</li>
<li>第九章 如何设计和处理异常</li>
<li>第十章 并发编程</li>
<li>第十一章 序列化,序列化代理模式</li>
</ul>
<h3 id="内容"><a href="#内容" class="headerlink" title="内容"></a>内容</h3><h4 id="第一章"><a href="#第一章" class="headerlink" title="第一章"></a>第一章</h4><p>第一章主题是创建和销毁对象,主要讲何时及如何创建对象,何时及如何避免创建对象,如何保证对象被正确的销毁,以及如何管理对象销毁前的各种清理工作</p>
<h5 id="Tip1-考虑使用静态工厂方法代替构造器"><a href="#Tip1-考虑使用静态工厂方法代替构造器" class="headerlink" title="Tip1 考虑使用静态工厂方法代替构造器"></a>Tip1 考虑使用静态工厂方法代替构造器</h5><p><a href="">url2tip1</a></p>
<h5 id="Tip2-遇到多个构造器参数时要考虑用构造器"><a href="#Tip2-遇到多个构造器参数时要考虑用构造器" class="headerlink" title="Tip2 遇到多个构造器参数时要考虑用构造器"></a>Tip2 遇到多个构造器参数时要考虑用构造器</h5><p><a href="">url2tip1</a></p>
<h5 id="Tip3-用私有构造器或者枚举类型强化Singleton属性"><a href="#Tip3-用私有构造器或者枚举类型强化Singleton属性" class="headerlink" title="Tip3 用私有构造器或者枚举类型强化Singleton属性"></a>Tip3 用私有构造器或者枚举类型强化Singleton属性</h5><p><a href="">url2tip1</a></p>
<h5 id="Tip4-通过私有化构造器强化不可实例化的能力"><a href="#Tip4-通过私有化构造器强化不可实例化的能力" class="headerlink" title="Tip4 通过私有化构造器强化不可实例化的能力"></a>Tip4 通过私有化构造器强化不可实例化的能力</h5><p><a href="">url2tip1</a></p>
<h5 id="Tip5-避免创建不必要的对象"><a href="#Tip5-避免创建不必要的对象" class="headerlink" title="Tip5 避免创建不必要的对象"></a>Tip5 避免创建不必要的对象</h5><p><a href="">url2tip1</a></p>
<h5 id="Tip6-避免过期的对象引用"><a href="#Tip6-避免过期的对象引用" class="headerlink" title="Tip6 避免过期的对象引用"></a>Tip6 避免过期的对象引用</h5><p><a href="">url2tip1</a></p>
<h5 id="Tip7-避免使用终结方法"><a href="#Tip7-避免使用终结方法" class="headerlink" title="Tip7 避免使用终结方法"></a>Tip7 避免使用终结方法</h5><p><a href="">url2tip1</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/06/charles使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sparky">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/logo_s.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sparky">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/06/charles使用/" itemprop="url">未命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-06T20:09:10+08:00">
                2019-05-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="ubuntu下使用charles抓包"><a href="#ubuntu下使用charles抓包" class="headerlink" title="ubuntu下使用charles抓包"></a>ubuntu下使用charles抓包</h2><h4 id="1-下载安装charles"><a href="#1-下载安装charles" class="headerlink" title="1. 下载安装charles"></a>1. 下载安装charles</h4><pre><code>1. wget -q -O - https://www.charlesproxy.com/packages/apt/PublicKey | sudo apt-key add -
2. sudo apt-key adv --keyserver pgp.mit.edu --recv-keys 1AD28806
3. sudo sh -c &apos;echo deb https://www.charlesproxy.com/packages/apt/ charles-proxy main &gt; /etc/apt/sources.list.d/charles.list&apos;
4. sudo apt-get update
5. sudo apt-get install charles-proxy
</code></pre><p>也可以直接安装体验版。</p>
<h4 id="2-设置"><a href="#2-设置" class="headerlink" title="2. 设置"></a>2. 设置</h4><h5 id="1-代理设置"><a href="#1-代理设置" class="headerlink" title="1. 代理设置"></a>1. 代理设置</h5><p>proxy -&gt; proxy settings，勾选Enable transparent HTTP proxying，默认端口8888就可以</p>
<h5 id="2-抓包设置-可选"><a href="#2-抓包设置-可选" class="headerlink" title="2. 抓包设置(可选)"></a>2. 抓包设置(可选)</h5><p>edit -&gt; preference -&gt; viewers，取消勾选combine request and response。</p>
<h4 id="3-手机抓包"><a href="#3-手机抓包" class="headerlink" title="3. 手机抓包"></a>3. 手机抓包</h4><p>charles也可以进行电脑抓包，上述设置完就可以了。</p>
<p>确保手机所链接的wifi和电脑wifi在同一局域网下。</p>
<p>手机wifi设置代理，主机为电脑ip，端口为8888.</p>
<p>设置完以后，手机打开任意网页看是否能够打开，如果不能，请重新检查上述步骤。如果可以的话，charles界面上也会显示url数据了。</p>
<h4 id="4-https"><a href="#4-https" class="headerlink" title="4. https"></a>4. https</h4><p>charles抓包打开https数据中有unknown，并且返回的数据中有乱码。这是因为没有设置https。</p>
<p>在上述步骤的基础上，在手机端打开<a href="http://chls.pro/ssl/" target="_blank" rel="noopener">http://chls.pro/ssl/</a> + ip + 端口。一般手机会提示下载安装证书，如果安装成功就可以进行https抓包了。</p>
<p>对小米手机，使用uc浏览器打开上边的<a href="http://chls.pro/ssl/" target="_blank" rel="noopener">http://chls.pro/ssl/</a> + ip + 端口下载pem证书.打开设置-&gt;更多设置-&gt;系统安全-&gt;从sd卡安装凭证，注意这里默认可能没有显示你下载的证书，点击左上角的按钮，不要选择最近或者下载内容，选择你的设备，然后出来文件系统，找到你下载的证书文件，点击即可安装。</p>
<h4 id="5-破解"><a href="#5-破解" class="headerlink" title="5. 破解"></a>5. 破解</h4><p>最新版v4.2.0破解文件下载:<br>链接: <a href="https://pan.baidu.com/s/1sl4YMK1" target="_blank" rel="noopener">https://pan.baidu.com/s/1sl4YMK1</a> 密码: b8cy</p>
<p>将下载的charles.jar覆盖到/usr/lib/charles-proxy文件夹下即可。</p>
<h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><p><a href="https://www.52pojie.cn/thread-619994-1-1.html" target="_blank" rel="noopener"> [原创破解] charles-proxy 抓包工具 v4.2 Win + Mac + Linux全平台破解文件 </a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/06/Binder机制-应用-AIDL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sparky">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/logo_s.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sparky">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/06/Binder机制-应用-AIDL/" itemprop="url">未命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-06T20:09:10+08:00">
                2019-05-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Binder机制-应用-AIDL"><a href="#Binder机制-应用-AIDL" class="headerlink" title="Binder机制-应用-AIDL"></a>Binder机制-应用-AIDL</h2><ol>
<li>创建aidl文件。在Android Studio中可以右键新建ITestService.aidl文件，添加接口。注意：支持的数据类型为java的基本数据类型，String，charsequence,list,map</li>
<li>自动生成对应的java文件。重新编译项目或者sync都会自动在app/build/generated/source/aidl/debug/目录下生成ITestService.aidl对应的.java文件。</li>
<li>编写service代码。新建service类，在onBind中返回ITestService.stub对象。在创建该对象时，实现ITestService.aidl中的方法。注意添加服务到manifast，设置服务exported=true,process=”xx”</li>
<li>编写client代码，service connection和bindservice。创建serviceconnection,在onServiceConnected中，先将binder转换为ITestService,然后调用接口，最后bindService</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/06/Android图书 分类/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sparky">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/logo_s.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sparky">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/06/Android图书 分类/" itemprop="url">未命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-06T20:09:10+08:00">
                2019-05-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Android开发图书分类"><a href="#Android开发图书分类" class="headerlink" title="Android开发图书分类"></a>Android开发图书分类</h2><ul>
<li>入门实战类。初中级开发者适合，主要是讲解Android基础知识，包括Android UI开发，数据存储，网络通信，数据库操作，传感器使用的基础知识，在加上几个实战项目练手和巩固。看完这些书之后基本都能达到中级开发水平，之后这些书就属于工具书的角色，查一查重新温习。</li>
<li>源码分析类。主要针对Android系统开发者，又分为Framework层源码分析类和Native层源码分析类。当然对于普通应用开发者来说如果了解底层的实现原理对个人发展大有裨益。</li>
<li>安全和逆向分析类。主要针对Android安全工程师，市场上有专门的系统安全相关的职位。这类书主要介绍Android平台的软件安全，逆向分析和加解密技术。主要设计Android软件的静态分析，动态调试，破解和反破解等技术以及一些Android系统安全策略。这个方向对Android应用开发者和Android系统开发者都有需要。</li>
<li>系统移植和驱动类。这类图书主要介绍的是Android内核，移植和驱动开发的整个底层的嵌入式开发知识，其实不属于移动端开发，属于传统的嵌入式开发，毕竟Android底层就是Linux系统。</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/06/Android框架/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sparky">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/logo_s.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sparky">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/06/Android框架/" itemprop="url">未命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-06T20:09:10+08:00">
                2019-05-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="linux内核"><a href="#linux内核" class="headerlink" title="linux内核"></a>linux内核</h3><h5 id="蓝牙驱动"><a href="#蓝牙驱动" class="headerlink" title="蓝牙驱动"></a>蓝牙驱动</h5><h5 id="wifi驱动"><a href="#wifi驱动" class="headerlink" title="wifi驱动"></a>wifi驱动</h5><h5 id="音频驱动"><a href="#音频驱动" class="headerlink" title="音频驱动"></a>音频驱动</h5><h5 id="照相机驱动"><a href="#照相机驱动" class="headerlink" title="照相机驱动"></a>照相机驱动</h5><h5 id="键盘驱动"><a href="#键盘驱动" class="headerlink" title="键盘驱动"></a>键盘驱动</h5><h5 id="usb驱动"><a href="#usb驱动" class="headerlink" title="usb驱动"></a>usb驱动</h5><h5 id="显示驱动"><a href="#显示驱动" class="headerlink" title="显示驱动"></a>显示驱动</h5><h5 id="flash内存驱动"><a href="#flash内存驱动" class="headerlink" title="flash内存驱动"></a>flash内存驱动</h5><h5 id="Binder-IPC驱动"><a href="#Binder-IPC驱动" class="headerlink" title="Binder IPC驱动"></a>Binder IPC驱动</h5><h5 id="电源驱动"><a href="#电源驱动" class="headerlink" title="电源驱动"></a>电源驱动</h5><h3 id="核心类库层"><a href="#核心类库层" class="headerlink" title="核心类库层"></a>核心类库层</h3><h5 id="c库"><a href="#c库" class="headerlink" title="c库"></a>c库</h5><h5 id="多媒体框架"><a href="#多媒体框架" class="headerlink" title="多媒体框架"></a>多媒体框架</h5><h5 id="sqlite"><a href="#sqlite" class="headerlink" title="sqlite"></a>sqlite</h5><h5 id="ssl"><a href="#ssl" class="headerlink" title="ssl"></a>ssl</h5><h5 id="open-gl-es"><a href="#open-gl-es" class="headerlink" title="open gl/es"></a>open gl/es</h5><h5 id="webkit"><a href="#webkit" class="headerlink" title="webkit"></a>webkit</h5><h5 id="freetype"><a href="#freetype" class="headerlink" title="freetype"></a>freetype</h5><h5 id="surface-manager"><a href="#surface-manager" class="headerlink" title="surface manager"></a>surface manager</h5><h5 id="sgl"><a href="#sgl" class="headerlink" title="sgl"></a>sgl</h5><h5 id="android虚拟机"><a href="#android虚拟机" class="headerlink" title="android虚拟机"></a>android虚拟机</h5><h3 id="framework层"><a href="#framework层" class="headerlink" title="framework层"></a>framework层</h3><h4 id="应用层"><a href="#应用层" class="headerlink" title="应用层"></a>应用层</h4>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/06/Android开发感悟/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sparky">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/logo_s.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sparky">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/06/Android开发感悟/" itemprop="url">未命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-06T20:09:10+08:00">
                2019-05-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Android系统开发工作感悟"><a href="#Android系统开发工作感悟" class="headerlink" title="Android系统开发工作感悟"></a>Android系统开发工作感悟</h2><ul>
<li>repo</li>
<li>git</li>
<li>gerrit</li>
<li>adb </li>
<li>fastboot</li>
<li>vim</li>
<li>bash</li>
<li>sourceinsight</li>
<li>putty</li>
<li>secureCRT</li>
<li>ssh</li>
<li>sftp</li>
<li>eclipse</li>
<li>android studio</li>
<li>linux</li>
<li>shell</li>
<li>makefile</li>
<li>python</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/06/Android混淆踩坑实践/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sparky">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/logo_s.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sparky">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/06/Android混淆踩坑实践/" itemprop="url">未命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-06T20:09:10+08:00">
                2019-05-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Android混淆踩坑实践"><a href="#Android混淆踩坑实践" class="headerlink" title="Android混淆踩坑实践"></a>Android混淆踩坑实践</h2><p>一般情况下，网上的大多数模板都是可用的，如果出错通常需要特殊的指定要不去混淆的类或方法等。</p>
<p>两种混淆错误，一种是编译时报错，一种是运行时报错。<br>编译时错误一般是某些类需要混淆。<br>运行时错误一般是库调用java代码出错。</p>
<h4 id="1-耐心看log，一般根据log就可以定位到错误的地方。"><a href="#1-耐心看log，一般根据log就可以定位到错误的地方。" class="headerlink" title="1. 耐心看log，一般根据log就可以定位到错误的地方。"></a>1. 耐心看log，一般根据log就可以定位到错误的地方。</h4><p>跟Android项目中的warning不一样这里的warning也会导致编译不过去</p>
<pre><code>Warning: Exception while processing task java.io.IOException: Please correct the above warnings first.
:fBReader:transformClassesAndResourcesWithProguardForRelease FAILED

FAILURE: Build failed with an exception.


遇到这种情况就滑到上边看log里的最上边的出现的warning

Note: the configuration refers to the unknown class &apos;android.webkit.webViewClient&apos;
Note: the configuration refers to the unknown class &apos;android.webkit.webViewClient&apos;
Note: the configuration refers to the unknown class &apos;android.webkit.webView&apos;
Note: the configuration refers to the unknown class &apos;jav.lang.String&apos;
      Maybe you meant the fully qualified name &apos;java.lang.String&apos;?
Note: the configuration refers to the unknown class &apos;org.greenrobot.greendao.AbstractDao&apos;
Warning: com.xxx.xxx: can&apos;t find superclass or interface android.xxx.xxx

说明com.xxx.xxx这个类出现了warning，在proguard.pro文件中添加

    -dontwarn com.xx.xx即可
</code></pre><h4 id="2-如果混淆之后打包编译都正常，千万不要以为万事大吉，一定要安装查看运行时基本功能是否正常"><a href="#2-如果混淆之后打包编译都正常，千万不要以为万事大吉，一定要安装查看运行时基本功能是否正常" class="headerlink" title="2. 如果混淆之后打包编译都正常，千万不要以为万事大吉，一定要安装查看运行时基本功能是否正常"></a>2. 如果混淆之后打包编译都正常，千万不要以为万事大吉，一定要安装查看运行时基本功能是否正常</h4><p>混淆之后经常出现运行时错误，也是需要去看应用crash的log，一行一行分析定位，实在不行就去google。</p>
<h5 id="1、ClassNotFoundException，NoSuchMethodError"><a href="#1、ClassNotFoundException，NoSuchMethodError" class="headerlink" title="1、ClassNotFoundException，NoSuchMethodError"></a>1、ClassNotFoundException，NoSuchMethodError</h5><p>找不到类和方法的原因很多，需要根据log去定位。</p>
<pre><code>Didn&apos;t find class &quot;xxx&quot; on path: DexPathList[[zip file &quot;/data/app/xxx/base.apk&quot;],nativeLibraryDirectories=[/data/app/xxx/lib/arm, /vendor/lib, /system/lib]]

然后java的loadLibrary方法会报错，这个问题乍一看可能以为是so库的问题，你可能回去不混淆so等，但是其实不用，因为so默认就是不混淆的，问题在于jni调用java类时，java类的路径因为混淆而发生变化，所以你需要去不去混淆这个类。

-keep class xxx{*;}

除了这种jni调用java会出现classnotfoundexception之外，本地代码通过反射调用其他的类等也会出现上述问题，只要分析log找到对应的类不混淆即可
</code></pre><h4 id="2、ExceptionInInitializerError"><a href="#2、ExceptionInInitializerError" class="headerlink" title="2、ExceptionInInitializerError"></a>2、ExceptionInInitializerError</h4><pre><code>原因：这是由于类初始化的时候发生了异常。

解决办法：找到具体是哪里的类哪个方法哪个类初始化的时候发生的异常，然后解决问题。

注：遇到这个错误，首先要确认是不是因为第三方的jar包导致的。如果不是的话，就找本地代码，看是不是写的有问题。如果确实是因为第三方jar包的代码导致的，尽量找到源码或者反编译，查看问题到底是什么引起的，然后找到相应的配置在proguard里面配置。

例如：我们项目中碰到过一个问题，就是因为第三方的jar包里面有一个字段初始化的时候报了空指针，然后导致我们的代码报了上面的错。当时很奇怪，为什么第三方的jar包还能报错，最后调查了之后才发现，是因为人家用到了类的注解，而proguard在混淆优化的时候把注解去掉了，所以报了空指针，只需要在proguard里面加上保护注解就可以了-keepattributes *Annotation*
</code></pre><h4 id="3、-ClassCastException"><a href="#3、-ClassCastException" class="headerlink" title="3、 ClassCastException"></a>3、 ClassCastException</h4><pre><code>原因：类强制转换的时候出错。

解决办法：找到代码，看是代码写的问题，还是混淆后的问题。如果没有混淆正常运行的话，一般都是因为混淆后遇到了各种问题才报的错。我们项目中遇到的问题是因为没有让proguard保持泛型，所以强转的时候报错。只需要在proguard文件里面加上泛型即可-keepattributes Signature
</code></pre><h4 id="4、Resources-NotFoundException-resource-not-found"><a href="#4、Resources-NotFoundException-resource-not-found" class="headerlink" title="4、Resources$NotFoundException(resource not found)"></a>4、Resources$NotFoundException(resource not found)</h4><p>资源没有找到，是因为第三方jar包或者自己的代码是通过反射获得R文件中的资源，所以需要将R文件屏蔽掉</p>
<pre><code>原因：代码进行了混淆，R文件没有了，所以通过反射获取的R文件找不到

解决办法：在proguard文件里设置不混淆R文件    -keep class **.R$* { *; }
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/06/Android高级进阶知识点/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sparky">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/logo_s.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sparky">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/06/Android高级进阶知识点/" itemprop="url">未命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-06T20:09:10+08:00">
                2019-05-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="1-触摸事件传递机制"><a href="#1-触摸事件传递机制" class="headerlink" title="1. 触摸事件传递机制"></a>1. 触摸事件传递机制</h4><ol>
<li>触摸事件的类型（MotionEvent(ACTION_DOWN,ACTION_MOVE,ACTION_UP等)）</li>
<li>触摸事件的三个阶段（分发-拦截-消费）</li>
<li>view的时间传递机制（activity-&gt;view）</li>
<li>viewgroup的时间传递机制 (activity-&gt;viewgroup-&gt;view)</li>
</ol>
<h4 id="2-Android-View的绘制流程"><a href="#2-Android-View的绘制流程" class="headerlink" title="2. Android View的绘制流程"></a>2. Android View的绘制流程</h4><p><a href="http://blog.csdn.net/yanbober/article/details/45970721" target="_blank" rel="noopener">setContentView方法详解</a></p>
<ol>
<li>Android UI管理系统的层级关系(activity-phonewindow-decorview-(titleview,contentview))</li>
<li>绘制的整个流程(performtraversals-&gt;performMeasure-&gt;performLayout-&gt;performDraw)</li>
<li>MesureSpec(unspecified,at_most(wrap_content),exactly(match_parent))</li>
<li>Measure</li>
<li>layout</li>
<li>draw(drawBackground-saveLayer-onDraw-dispatchDraw-restoreToCount-onDrawScrollBar)</li>
</ol>
<h4 id="3-Android动画"><a href="#3-Android动画" class="headerlink" title="3. Android动画"></a>3. Android动画</h4><ol>
<li>帧动画（xml方式/动画方式添加）</li>
<li>补间动画（alpha/rotate/scale/translate，添加方式）</li>
<li>属性动画（Evaluator，animatorset，valueanimator，objectanimator）</li>
<li><p>过渡动画（transition）（本质是属性动画，但是对属性动画做了封装，方便实现过度动画的效果。需要动画前后两个布局）（定义transition的步骤：1. 定义动画前后两个布局 2. 根据布局文件创建布局前后的scene 3. 创建过度动画transitionset 4. 调用TransitionManager.go(scene, transitionSet)）</p>
<ul>
<li>scene（定义页面信息）</li>
<li>transition（changebounds，fade，transitionset，autotransition）</li>
<li>transitionmanager（切换控制器）</li>
</ul>
</li>
</ol>
<h4 id="4-Support-Annotation-Library"><a href="#4-Support-Annotation-Library" class="headerlink" title="4. Support Annotation Library"></a>4. Support Annotation Library</h4><ol>
<li>基础概念（support library，support annotion library）</li>
<li>Nullness注解（@NonNull，@Nullable）</li>
<li>资源文件类型注解（@AnimatorRes,@AnimRes,@AnyRes,@ArrayRes,@AttrRes,@BoolRes,@ColorRes,@DrawableRes,@FractionRes,@IdRes,@IntegerRes,@InterpolatorRes,@LayoutRes,@MenuRes,@PluralsRes,@RawRes,@StringRes,@StyleableRes,@StyleRes,@TransitionRes,@XmlRes）</li>
<li>权限注解(@RequiresPermission)</li>
<li>类型定义注解(@IntDef @interface @Retention，定义注解类)</li>
<li>线程注解（@MainThread，@UiThread, @WorkThread,@BinderThread）</li>
<li>颜色值注解(@ColorInt)</li>
<li>值范围注解(@Size(n),@Size(max=m),@Size(min=n),@Size(Multiple=2),@IntRange(from=0,to=255),@FloatRange(from=0.0,to=1.0))</li>
<li>重写函数注解(@CallSuper)</li>
<li>返回值注解(@CheckResult)</li>
<li>keep注解(@keep)</li>
<li>visibletest注解(@VisibleTest)</li>
<li>lint的用法(Analyze-&gt;Inspect Code-&gt;选择范围)</li>
</ol>
<h4 id="5-Percent-Support-Library（百分比布局）"><a href="#5-Percent-Support-Library（百分比布局）" class="headerlink" title="5. Percent Support Library（百分比布局）"></a>5. Percent Support Library（百分比布局）</h4><ol>
<li>PercentRelativeLayout</li>
<li>PercentFramelayout</li>
<li>layout_heightPercent/layout_widthPercent</li>
<li>aspectRatio</li>
</ol>
<h4 id="6-Design-Support-Library"><a href="#6-Design-Support-Library" class="headerlink" title="6. Design Support Library"></a>6. Design Support Library</h4><ol>
<li>简介，snackbar，navigationview,floatingactionbutton,coordinatorlayout,constraintlayout,collapsingtoolbarlayout</li>
<li>snackbar（setAction）</li>
<li>textinputlayout(用法设置为edittext的父布局)</li>
<li>tablayout</li>
<li><p>navigationview</p>
<p> 5.1 导航菜单<br> 5.2 导航头部</p>
</li>
<li><p>FloatingActionButton</p>
<p> 6.1 基本属性（elevation（未按压状态的阴影），pressedTranslationZ（按压状态的阴影））<br> 6.2 其它选项（backgroundTint（背景颜色），rippleColor（波纹颜色），fabSize（可选尺寸））</p>
</li>
<li><p>CoordinatorLayout(协调布局，可以使不同布局的组件之间直接相互作用，并且协调动画效果)（例如，floatingactionbar和snackbar，点击floatingactionbutton出现snackbar，然后floatingactionbutton自动往上移动，snackbar消失时，floatingactionbutton自动往下移动，这里就需要将coordinatorlayout作为floatingactionbutton的父容器）</p>
</li>
<li>CollapsingToolbarLayout(可以实现当屏幕内容滚动时，toolbar收缩的效果，通常和appbar配合使用)</li>
<li>BottomSheetBehavior（1. 布局中添加app:layout_behavior属性，并将这个view作为coordinatorlayout的子view 2. 布局文件中创建bottomsheetbehavior对象，并设置状态变化的监听）</li>
</ol>
<h4 id="7-NDK开发"><a href="#7-NDK开发" class="headerlink" title="7. NDK开发"></a>7. NDK开发</h4><ol>
<li>ABI（应用程序二进制接口application binary interface）（arm-v5,arm-v7,arm-v8,x86,x86_64,mips,mips6）</li>
<li>引入预编译的二进制文件</li>
<li>自己写c/c++文件</li>
<li>使用.so文件的注意事项</li>
</ol>
<h4 id="8-Gradle必知必会"><a href="#8-Gradle必知必会" class="headerlink" title="8. Gradle必知必会"></a>8. Gradle必知必会</h4><ol>
<li>概念（是Android studio标配的构建系统，settings.gradle,project build.gradle,module build.gradle,gradle的文件结构）</li>
<li>共享变量（1. 在项目路径下创建xxx.gradle文件 2. 在文件中定义变量如project.ext{javaVersion = 1.8} 3. 在module build.gradle中apply from: “${project.rootDir}/xxx.gradle”，然后引用变量名就可以）</li>
<li>通用配置（在project build.gradle下创建subprojects{}定义配置）</li>
<li>如何引用aar（1. 指定aar文件的位置，在module build.gradle中的android节点下创建repositories{flatDir{dirs ‘libs’}} 2. 在dependencies节点下添加compile(name: ‘xxx’, ext: ‘aar’)）    </li>
<li>签名混淆的配置</li>
</ol>
<h4 id="9-gradle打包发布"><a href="#9-gradle打包发布" class="headerlink" title="9. gradle打包发布"></a>9. gradle打包发布</h4><ol>
<li>maven central</li>
<li>jcenter</li>
<li>jitpack</li>
</ol>
<h4 id="10-Builder建造者模式详解"><a href="#10-Builder建造者模式详解" class="headerlink" title="10. Builder建造者模式详解"></a>10. Builder建造者模式详解</h4><ol>
<li>经典的建造者模式（java设计模式之建造者模式）</li>
<li>建造者模式的变种</li>
<li>变种的自动化生成</li>
<li>使用builder模式的开源例子</li>
</ol>
<h4 id="11-注解在Android中的使用"><a href="#11-注解在Android中的使用" class="headerlink" title="11. 注解在Android中的使用"></a>11. 注解在Android中的使用</h4><ol>
<li>注解的定义（java语言的特性之一，他是在源代码中插入的标签，在之后的编译和运行中起到某种作用，每个注解都必须通过@interface进行声明，接口的方法对应着注解的元素）</li>
<li><p>标准注解（java包中默认给出的注解）</p>
<p> 2.1 编译相关的注解（@override，@deprecated，@suppresswarnings，@safevarargs，@generated，@functuinalinterface）</p>
<p> 2.2 资源相关的注解（javaee中用到）（@PostConstruct，@PreDestroy，@Resource，@resources）</p>
<p> 2.3 元注解（用来定义和实现注解的注解）</p>
<pre><code>2.3.1 @Target（指定注解所适用的对象的范围）

2.3.2 @Retention（用来指明注解的访问范围，也就是在什么级别保留注解）（源码级注解（@Retention(RetentionPolicy.SOURCE)）,编译级注解(@Retention(RetentionPolicy.CLASS)),运行时注解（@Retention（RetentionPolicy.RUNTIME）））

2.3.3 @Documented（表示被修饰的注解应该保存在被注解项的文档中）

2.3.4 @Inherited（表示该注解可以被子类继承）

2.3.5 @Repeatable（表示这个注解可以在注解项上应用多次）
</code></pre></li>
<li><p>运行时注解（该注解会被保存在.class和.java文件中，在执行时，也保留注解信息。可以通过反射机制读取注解的信息）</p>
</li>
<li>编译时注解</li>
</ol>
<h4 id="12-ANR产生的原因及定位分析"><a href="#12-ANR产生的原因及定位分析" class="headerlink" title="12. ANR产生的原因及定位分析"></a>12. ANR产生的原因及定位分析</h4><ol>
<li><p>ANR产生的原因</p>
<p> 只有当UI线程响应超时才会引起ANR，主要两种原因导致超时，1. 事件被阻塞，正在处理其它阻塞事件 2. 自身处理事件耗时太长。<br> activity/view 5s， broadcast 10s， Service 20s</p>
</li>
<li><p>经典场景</p>
<ol>
<li>应用程序UI线程中存在耗时操作，例如在UI线程中进行网络操作，数据库操作和文件操作等，导致ui线程阻塞无法响应用户数据等。</li>
<li>应用程序的ui线程在等待工作线程释放某个锁，从而无法处理事件</li>
<li>耗时的动画需要大量的计算工作，可能导致CPU负荷过重</li>
</ol>
</li>
<li><p>定位和分析</p>
<ol>
<li>logcat分析可以看到是anr发生的进程及包名和类名，pid，reason，cpu使用情况</li>
<li>如果还是没有具体定位到anr发生的位置，就需要借助/data/anr/xxx.txt文件。文件包括发生anr的进程名，id和时间，cpu架构，堆内存的使用情况，线程信息，以及anr发生的位置及错误信息。</li>
</ol>
</li>
<li>避免和检测<br> 不要在主线程做耗时操作，使用检测工具检测存在违规操作的工具类</li>
</ol>
<h4 id="13-Android异步处理技术"><a href="#13-Android异步处理技术" class="headerlink" title="13. Android异步处理技术"></a>13. Android异步处理技术</h4><p>常见的异步处理技术：Thread，AsyncTask，Handler &amp; Looper， Executors。</p>
<p>Handler异步处理消息机制：</p>
<ol>
<li>Looper.prepare方法会在本线程中创建一个Looper实例，在实例化过程中会创建一个MessageQueue，这个looper实例会被保存到ThreadLocal对象中(ThreadLocal对像可以再线程中存储变量)</li>
<li>Looper.loop方法会让当前线程进入一个无限循环，不断的从Messagequeue中得到message对象，并且通过msg.target.dispatchMessage将消息发送出去</li>
<li>Handler的构造方法会获取当前线程中保存的looper实例，并与looper对象的messagequeue关联起来</li>
<li>handler.sendmessage中将msg.tar设置为handler对象本身，并将message添加到messagequue中</li>
<li>msg.target.dispatchmessage即是handler.dispatchmessage，他会回调handler.message方法</li>
</ol>
<h6 id="1-Thread"><a href="#1-Thread" class="headerlink" title="1. Thread"></a>1. Thread</h6><p>概念： 执行任务的基本单元</p>
<p>2种创建方式： 继承Thread，实现runnable</p>
<p>3种线程的分类：</p>
<ul>
<li>主线程（ui线程），随着应用启动而启动，用来运行Android组件，刷新组件元素。通过handle顺序处理其它线程发来的消息。</li>
<li>binder线程，Binder线程用于不同进程之间的通信，每个应用在创建之后，就创建了一个线程池，用于处理其它进程的线程发送的消息，经典场景是aidl</li>
<li>后台线程（工作线程）</li>
</ul>
<h6 id="2-HandlerThread"><a href="#2-HandlerThread" class="headerlink" title="2. HandlerThread"></a>2. HandlerThread</h6><p>HandlerTread是Thread的子类，它内部集成了Looper和MessageQueue。内部其实也是handler机制。</p>
<h6 id="3-AsyncQueryHandler"><a href="#3-AsyncQueryHandler" class="headerlink" title="3. AsyncQueryHandler"></a>3. AsyncQueryHandler</h6><p>主要用于contentprovider中的异步数据查询，不常用</p>
<h6 id="4-AsyncTask"><a href="#4-AsyncTask" class="headerlink" title="4. AsyncTask"></a>4. AsyncTask</h6><pre><code>asynctask task = new asynctask(){
    onpreexecute();
    onpostexecute();
    doinbackground();
    onprogressupdate();
};
task.execute();
</code></pre><p>构造方法中创建mHandler,mWork,mFuture-&gt;execute()-&gt;executeOnExecutor() 1. onpreexecute() 2. exec.execute()-&gt;exec.execute() exec对象是在execute方法中的参数，是sdefaultexecutor成员变量实际上是一个SerialExecutor类的实例-&gt;创建serialexecutor对象会首先生成arraydeque队列，将mfuture对象封装成runnable添加到队列中，判断mactive是否为空，如果为空执行scheduleNext()-&gt;这个方法会先去将队列的队尾赋值为mactive，然后执行THREAD_POOL_EXECUTOR.execute(mactive)方法-&gt;实际上THREAD_POOL_EXECUTOR是一个线程池，相当于执行线程的run方法-&gt;mactive对象实际上是mFuture，FutureTask.run实际上会执行callable.call()-&gt;mWork.call() 1. 执行doinbackground 2. 执行postresult-&gt;postresult 1. 封装result为message，message 2. 调用message.senttotarget发送。实际上是调用handle处理消息-&gt;mhandler对象handlemessage,两种事件 1. PostResult 回调onCancel,onPostExecute 2. PostProgress 回调onProgressUpdate</p>
<h6 id="5-Loader"><a href="#5-Loader" class="headerlink" title="5. Loader"></a>5. Loader</h6><p>不常用</p>
<h4 id="14-Android数据序列化"><a href="#14-Android数据序列化" class="headerlink" title="14. Android数据序列化"></a>14. Android数据序列化</h4><h4 id="15-WebView"><a href="#15-WebView" class="headerlink" title="15. WebView"></a>15. WebView</h4>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/06/Android_将独立应用作为module导入/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sparky">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/logo_s.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sparky">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/06/Android_将独立应用作为module导入/" itemprop="url">未命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-06T20:09:10+08:00">
                2019-05-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="将独立应用作为library-module导入项目"><a href="#将独立应用作为library-module导入项目" class="headerlink" title="将独立应用作为library module导入项目"></a>将独立应用作为library module导入项目</h2><p>可以视为插件化思想,之后可以作为插件方便调用.</p>
<ol>
<li>File-New-Import Module</li>
<li>修改module build.gradle.主要修改: 1. 将apply plugin: ‘com.android.application’改为’com.android.library’ . 2. 将applicationId删除 3. 如果有releaseConfigs 删除之.</li>
<li>修改Module AndroidManifest.xml. 主要修改: 将application标签中的icon leble等去掉</li>
<li>代码修改. 1. library module中不能使用switch case,android studio alt+enter 自动修复代码可以自动转换 2. 如果module中使用了butterkenife,可参考butterknife readme中步骤将R替换为R2. 3. 项目中可能使用了系统数据库,需要修改系统数据库path,也可以改为直接使用getapplicationcontext().getdatabasepath(databsename).getabsolutepath();</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/6/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/8/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/uploads/logo_s.jpg"
                alt="Sparky" />
            
              <p class="site-author-name" itemprop="name">Sparky</p>
              <p class="site-description motion-element" itemprop="description">我是谁？我在做什么？我为什么要这么做？我想做什么？我要怎么做？</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">105</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Sparky</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
